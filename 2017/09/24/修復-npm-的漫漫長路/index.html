<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="theme-color" content="#600090"><meta name="msapplication-navbutton-color" content="#600090"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#600090"><meta property="og:image" content="https://khiav223577.github.io/blog/imgs/npm_update_check_failed.png"><meta property="og:image" content="https://khiav223577.github.io/blog/imgs/wolf.jpg"><meta property="og:image" content="/blog/imgs/forest_wolf.png"><meta name="description" content="不知道為什麼，裝了幾個套件後 npm 就掛了。只好開始修復 npm 的漫漫長路…深深感受到 npm 滿滿的坑 XD$ npm  module.js:471     throw err;     ^ Error: Cannot find module &amp;#39;../lib/utils/unsupported.js&amp;#39;     at Function.Module._resolveFilena"><meta name="keywords" content="npm"><meta property="og:type" content="article"><meta property="og:title" content="修復 npm 的漫漫長路｜像哈士奇的狼"><meta property="og:url" content="https://khiav223577.github.io/blog/2017/09/24/修復-npm-的漫漫長路/index.html"><meta property="og:site_name" content="狼"><meta property="og:description" content="不知道為什麼，裝了幾個套件後 npm 就掛了。只好開始修復 npm 的漫漫長路…深深感受到 npm 滿滿的坑 XD$ npm  module.js:471     throw err;     ^ Error: Cannot find module &amp;#39;../lib/utils/unsupported.js&amp;#39;     at Function.Module._resolveFilena"><meta property="og:updated_time" content="2017-11-20T19:15:43.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="修復 npm 的漫漫長路｜像哈士奇的狼"><meta name="twitter:description" content="不知道為什麼，裝了幾個套件後 npm 就掛了。只好開始修復 npm 的漫漫長路…深深感受到 npm 滿滿的坑 XD$ npm  module.js:471     throw err;     ^ Error: Cannot find module &amp;#39;../lib/utils/unsupported.js&amp;#39;     at Function.Module._resolveFilena"><meta property="fb:app_id" content="172563456645359"><link rel="shortcut icon" href="/blog/imgs/wolf.ico"><link rel="alternate" type="application/atom+xml" title="狼" href="/atom.xml"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.css"><title>修復 npm 的漫漫長路｜像哈士奇的狼</title><link rel="canonical" href="https://khiav223577.github.io/blog/blog/2017/09/24/修復-npm-的漫漫長路/"><link rel="stylesheet" href="/blog/css/bootstrap.min.css"><link rel="stylesheet" href="/blog/css/blog-style.css"><script async src="/blog/js/algolia.js"></script><script async src="/blog/js/instantsearch.min.js"></script></head><style>header.intro-header{background-image:url(/blog/imgs/water-blue.jpg)}</style><body ontouchstart="" class="animated fadeIn"><nav class="navbar navbar-default navbar-custom navbar-fixed-top" id="nav-top" data-ispost="true" data-istags="false" data-ishome="false" data-isarchive="false"><div class="container-fluid"><div class="navbar-header page-scroll"><button type="button" class="navbar-toggle"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand animated pulse" href="/blog/">像哈士奇的<span class="brand-logo"> 狼</span></a></div><div id="huxblog_navbar"><div class="navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href="/blog/">Home</a></li><li><a href="/blog/archive/">Archive</a></li><li><a href="/blog/tags/">Tags</a></li><li><a href="#search" class="popup-trigger"><i class="fa fa-search"></i></a></li></ul></div></div></div></nav><script>function handleMagic(e){$navbar.className.indexOf("in")>0?($navbar.className=" ",setTimeout(function(){$navbar.className.indexOf("in")<0&&($collapse.style.height="0px")},400)):($collapse.style.height="auto",$navbar.className+=" in")}var $toggle=document.querySelector(".navbar-toggle"),$navbar=document.querySelector("#huxblog_navbar"),$collapse=document.querySelector(".navbar-collapse");$toggle.addEventListener("click",handleMagic)</script><div class="site-search"><div class="algolia-popup popup"><div class="algolia-search"><div class="algolia-search-input-icon"><i class="fa fa-search"></i></div><div class="algolia-search-input" id="algolia-search-input"></div></div><div class="algolia-results"><div id="algolia-stats"></div><div id="algolia-hits"></div><div id="algolia-pagination" class="algolia-pagination"></div></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div></div><img class="wechat-title-img" src="/blog/imgs/npm_update_check_failed.png"><style>header.intro-header{background-image:url(/blog/imgs/npm_update_check_failed.png)}</style><header class="intro-header"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center"><div class="post-heading"><h1>修復 npm 的漫漫長路</h1><span class="meta"><span>作者 狼 </span><span class="spliter">|</span> <span>日期 2017-09-24 </span><span class="spliter">|</span> <span id="busuanzi_container_page_pv"><i class="fa fa-eye"></i> <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span></span></span><div class="tags text-center"><a class="tag" href="/blog/tags/#npm" title="npm">npm</a></div></div></div></div></div><div class="post-title-haojen"><span>修復 npm 的漫漫長路</span></div></header><article><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-1 col-sm-9 post-container"><p>不知道為什麼，裝了幾個套件後 <code>npm</code> 就掛了。只好開始修復 <code>npm</code> 的漫漫長路…<br>深深感受到 <code>npm</code> 滿滿的坑 XD</p><pre><code>$ npm

module.js:471
    throw err;
    ^
Error: Cannot find module &#39;../lib/utils/unsupported.js&#39;
    at Function.Module._resolveFilename (module.js:469:15)
    at Function.Module._load (module.js:417:25)
    at Module.require (module.js:497:17)
    at require (internal/module.js:20:19)
    at /usr/local/lib/node_modules/npm/bin/npm-cli.js:19:21
    at Object.&lt;anonymous&gt; (/usr/local/lib/node_modules/npm/bin/npm-cli.js:92:3)
    at Module._compile (module.js:570:32)
    at Object.Module._extensions..js (module.js:579:10)
    at Module.load (module.js:487:32)
    at tryModuleLoad (module.js:446:12)
</code></pre><h2 id="Reinstall-npm"><a href="#Reinstall-npm" class="headerlink" title="Reinstall npm"></a>Reinstall npm</h2><p>先試著重裝 <code>npm</code> 好了</p><pre><code>$ brew uninstall --ignore-dependencies npm
$ brew install npm
$ npm

module.js:471
    throw err;
    ^
</code></pre><p>等待半小時終於裝好<br>結果還是一樣，噴出同樣的錯誤</p><h2 id="Remove-node-modules"><a href="#Remove-node-modules" class="headerlink" title="Remove node_modules"></a>Remove node_modules</h2><p>Google 一下為什麼，找到這篇。有二十幾個讚，看起來不錯。<br><a href="https://github.com/olefredrik/FoundationPress/issues/780" target="_blank" rel="external">Missing modules when running npm run build or npm install</a></p><blockquote><p>The error in the original post is from running npm run build. I want to see the error from npm install<br>　<br>Please do the following:<br>rm -rf node_modules<br>npm install<br>provide the contents of that error message<br>　<br>Thanks.</p></blockquote><p>文章建議移除全部套件後再重裝<br>以前也有不少次經驗是移除後再裝，就能恢復正常了 XD<br>那就試看看吧：</p><pre><code>$ sudo rm -rf /usr/local/lib/node_modules/
$ npm install
-bash: /usr/local/bin/npm: No such file or directory
</code></pre><p>結果變成找不到 <code>npm</code> 了 @@</p><h2 id="Reinstall-npm-again"><a href="#Reinstall-npm-again" class="headerlink" title="Reinstall npm again"></a>Reinstall npm again</h2><p>再重裝一次試看看</p><pre><code>$ brew install npm
Updating Homebrew...
==&gt; Auto-updated Homebrew!
Updated 1 tap (homebrew/core).
No changes to formulae.

Warning: node 8.5.0 is already installed, it&#39;s just not linked.
You can use `brew link node` to link this version.
</code></pre><p>系統說已經有 <code>npm</code> 了，但連結不到！？</p><h2 id="Link-node"><a href="#Link-node" class="headerlink" title="Link node"></a>Link node</h2><p>可能是什麼參照沒有設定好，照 command line 中的提示打打看。</p><pre><code>$ brew link node

Linking /usr/local/Cellar/node/8.5.0... 
Error: Could not symlink share/doc/node/lldb_commands.py
Target /usr/local/share/doc/node/lldb_commands.py
already exists. You may want to remove it:
  rm &#39;/usr/local/share/doc/node/lldb_commands.py&#39;

To force the link and overwrite all conflicting files:
  brew link --overwrite node

To list all files that would be deleted:
  brew link --overwrite --dry-run node
</code></pre><p>系統提示說 <code>conflicts</code> 了，直接用最新的覆寫舊的應該 OK 吧</p><pre><code>$ brew link --overwrite node

Linking /usr/local/Cellar/node/8.5.0... 
Error: Could not symlink share/doc/node/gdbinit
/usr/local/share/doc/node is not writable.
</code></pre><p>權限不足無法覆寫，只好改一下檔案權限再試一次</p><pre><code>$ sudo rm &#39;/usr/local/share/doc/node/gdbinit&#39;
$ sudo chown -R $USER /usr/local
$ brew link --overwrite node
$ npm
-bash: /usr/local/bin/npm: No such file or directory
</code></pre><p>沒用 😿</p><h2 id="brew-doctor"><a href="#brew-doctor" class="headerlink" title="brew doctor"></a>brew doctor</h2><p>查到 brew 有指令能修復，試試看</p><pre><code>$ brew doctor
$ brew prune
$ npm
-bash: /usr/local/bin/npm: No such file or directory
</code></pre><p>沒用x2 😿😿</p><h2 id="Reinstall-npm-again-2"><a href="#Reinstall-npm-again-2" class="headerlink" title="Reinstall npm again 2"></a>Reinstall npm again 2</h2><p>用另一種方式裝 <code>npm</code> 看看</p><pre><code>$ curl -L http://npmjs.org/install.sh | sudo sh
$ npm
&gt; -bash: /usr/local/bin/npm: No such file or directory
</code></pre><p>沒用x3 😿😿😿</p><h2 id="用非-brew-的方式裝-npm"><a href="#用非-brew-的方式裝-npm" class="headerlink" title="用非 brew 的方式裝 npm"></a>用非 brew 的方式裝 npm</h2><p>查到一篇文章說， <code>npm</code> 用官網建議的方式裝，不要用 <code>brew</code> 裝<br><a href="https://gist.github.com/DanHerbert/9520689" target="_blank" rel="external">Fixing npm On Mac OS X for Homebrew Users</a></p><blockquote><p>Installing node through Homebrew can cause problems with npm for globally installed packages. To fix it quickly, use the solution below. An explanation is also included at the end of this document.</p></blockquote><p>照著它的指令安裝看看</p><h3 id="Remove-node"><a href="#Remove-node" class="headerlink" title="Remove node"></a>Remove node</h3><p>先移除剛才裝的 <code>node</code></p><pre><code>$ rm -rf /usr/local/lib/node_modules
$ brew uninstall --ignore-dependencies node

Uninstalling /usr/local/Cellar/node/8.5.0... (4,082 files, 17.2MB)
Error: Permission denied - /usr/local/Cellar/node/8.5.0/lib/node_modules/npm

$ sudo brew uninstall --ignore-dependencies node

Error: Running Homebrew as root is extremely dangerous and no longer supported.
As Homebrew does not drop privileges on installation you would be giving all
build scripts full access to your system.
</code></pre><p>結果還刪不掉，只好硬砍</p><pre><code>$ sudo rm -f /usr/local/Cellar/node/8.5.0/lib/node_modules/npm
$ brew uninstall --ignore-dependencies node

Uninstalling /usr/local/Cellar/node/8.5.0... (4,081 files, 17.2MB)
Error: Permission denied - /usr/local/Cellar/node/8.5.0/share/man/man5/npm-folders.5

$ sudo rm -rf /usr/local/Cellar/node
$ brew uninstall --ignore-dependencies node
</code></pre><p>總算刪掉</p><h3 id="安裝沒有-npm-的-node"><a href="#安裝沒有-npm-的-node" class="headerlink" title="安裝沒有 npm 的 node"></a>安裝沒有 npm 的 node</h3><p>照著文章的教學走，先裝 <code>node</code>，但不要裝 <code>npm</code></p><pre><code>$ brew install node --without-npm
$ echo prefix=~/.npm-packages &gt;&gt; ~/.npmrc
</code></pre><p>等待半小時終於裝好，然後用官網的安裝方式安裝 <code>npm</code></p><pre><code>$ curl -L https://www.npmjs.com/install.sh | sh
$ export PATH=&quot;$HOME/.npm-packages/bin:$PATH&quot;
</code></pre><p>再等待數十分鐘的安裝時間，等到快要睡著 XD</p><pre><code>$ npm
-bash: npm: command not found
</code></pre><p>結果一點用也沒有 😿😿😿😿</p><h2 id="Search-npm-location"><a href="#Search-npm-location" class="headerlink" title="Search npm location"></a>Search npm location</h2><p>感覺 <code>npm</code> 是有成功裝好，但只是參照路徑沒有設好，所以找不到<br>下指令搜尋一下 npm 在哪裡：</p><pre><code>find / -iname npm
</code></pre><p>結果找不到實體執行檔，都是捷徑，冏<br>不知道我的 <code>npm</code> 跑去哪裡了</p><h2 id="Reinstall-npm-again-3"><a href="#Reinstall-npm-again-3" class="headerlink" title="Reinstall npm again 3"></a>Reinstall npm again 3</h2><p>找到一篇 <a href="http://iambigd.blogspot.tw/2014/06/npm.html" target="_blank" rel="external">Mac 重新安裝 npm</a> 的教學<br>可能是我東西沒有刪乾淨，因此照著該 blog 的方法刪資料：</p><pre><code>$ brew uninstall --ignore-dependencies node
$ rm -rf /usr/local/bin/node
$ rm -rf /usr/local/bin/npm
$ rm -rf /usr/local/bin/node_modules
</code></pre><p>然後再安裝一次</p><pre><code>$ brew install node
$ npm -v
5.3.0
</code></pre><p>結果就成功啦！！</p><p>原來一切就只是我重新安裝時，資料沒有清乾淨惹的禍 😪</p><p>不過總算能繼續開發程式了～～<br>感恩師父，讚嘆師父</p><hr><ul class="pager"><li class="previous"><a href="/blog/2017/09/11/Ruby-code-tracing-技巧/" data-toggle="tooltip" data-placement="top" title="Ruby code tracing 技巧">&larr; Previous Post</a></li><li class="next"><a href="/blog/2017/11/16/如何在遊戲中自動安裝字型/" data-toggle="tooltip" data-placement="top" title="如何在遊戲中自動安裝字型">Next Post &rarr;</a></li></ul><div class="comment"><div id="disqus_thread" class="disqus-thread"></div></div></div><div class="hidden-xs col-sm-3 toc-col"><div class="toc-wrap"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Reinstall-npm"><span class="toc-text">Reinstall npm</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Remove-node-modules"><span class="toc-text">Remove node_modules</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reinstall-npm-again"><span class="toc-text">Reinstall npm again</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Link-node"><span class="toc-text">Link node</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#brew-doctor"><span class="toc-text">brew doctor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reinstall-npm-again-2"><span class="toc-text">Reinstall npm again 2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#用非-brew-的方式裝-npm"><span class="toc-text">用非 brew 的方式裝 npm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Remove-node"><span class="toc-text">Remove node</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安裝沒有-npm-的-node"><span class="toc-text">安裝沒有 npm 的 node</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Search-npm-location"><span class="toc-text">Search npm location</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reinstall-npm-again-3"><span class="toc-text">Reinstall npm again 3</span></a></li></ol></div></div></div></div></article><script type="text/javascript">var disqus_shortname="khiav-blog-1",disqus_identifier="https://khiav223577.github.io/blog/2017/09/24/修復-npm-的漫漫長路/",disqus_url="https://khiav223577.github.io/blog/2017/09/24/修復-npm-的漫漫長路/";!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}()</script><script>function async(e,n){var t=document,a="script",r=t.createElement(a),c=t.getElementsByTagName(a)[0];r.src=e,n&&r.addEventListener("load",function(e){n(null,e)},!1),c.parentNode.insertBefore(r,c)}</script><script>async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){anchors.options={visible:"hover",placement:"right"},anchors.add().remove(".intro-header h1").remove(".subheading").remove(".sidebar-container h5")})</script><style>@media all and (min-width:800px){.anchorjs-link{position:absolute;left:-.75em;font-size:1.1em;margin-top:-.1em}}</style><footer><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1 text-center"><br><div class="sidebar-container" style="padding:0"><div style="margin-top:20px"><h5 class="text-center">友情連結</h5><ul class="list-inline text-center"><li><a target="_blank" href="http://echo2010.weebly.com/">回音</a></li><li><a target="_blank" href="https://www.pagamo.org/">PaGamO</a></li><li><a target="_blank" href="https://www.pneko.com/">Pneko</a></li></ul></div></div><ul class="list-inline text-center" style="margin-top:25px"><li><a target="_blank" href="https://www.facebook.com/khiav.reoy"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-facebook fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" href="https://github.com/khiav223577"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a target="_blank" href="https://www.linkedin.com/in/rumble-huang"><span class="fa-stack fa-lg"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">Copyright &copy; 狼 2018<br><span><span id="busuanzi_container_site_pv"><i class="fa fa-eye" style="margin-right:3px" data-toggle="tooltip" title="本站總訪問量"></i> <span id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin"></i></span> </span><span style="margin:0 5px">| </span><span id="busuanzi_container_site_uv"><i class="fa fa-user" style="margin-right:2px" data-toggle="tooltip" title="本站總訪客數"></i> <span id="busuanzi_value_site_uv"><i class="fa fa-spinner fa-spin"></i></span></span></span><br><br>Theme by <a target="_blank" href="https://haojen.github.io/">Haojen Ma</a></p></div></div></div></footer><script src="/blog/js/jquery.min.js"></script><script src="/blog/js/bootstrap.min.js"></script><script src="/blog/js/blog.js"></script><script>function async(e,n){var t=document,a="script",r=t.createElement(a),c=t.getElementsByTagName(a)[0];r.src=e,n&&r.addEventListener("load",function(e){n(null,e)},!1),c.parentNode.insertBefore(r,c)}</script><script>0!==$("#tag_cloud").length&&async("https://khiav223577.github.io/blog/blog/js/jquery.tagcloud.js",function(){$.fn.tagcloud.defaults={color:{start:"#bbbbee",end:"#0085a1"}},$("#tag_cloud a").tagcloud()})</script><script>async("//cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js",function(){var c=document.querySelector("nav");c&&FastClick.attach(c)})</script><script>var _gaId="UA-89612344-1",_gaDomain="auto";!function(a,e,n,t,o,c,g){a.GoogleAnalyticsObject=o,a[o]=a[o]||function(){(a[o].q=a[o].q||[]).push(arguments)},a[o].l=1*new Date,c=e.createElement(n),g=e.getElementsByTagName(n)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",g.parentNode.insertBefore(c,g)}(window,document,"script",0,"ga"),ga("create",_gaId,_gaDomain),ga("send","pageview")</script><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/blog/js/run_prettify.js"></script><script>$(function(){$("pre > code[class]").addClass("prettyprint"),PR.prettyPrint()})</script><img class="wechat-title-img" src="/blog/imgs/wolf.jpg"></body></html>